<!DOCTYPE html>
<html>
<head>
<title></title>
<meta name="viewport" content="width=device-width">
</head>
<body style="padding:0;margin:0">
<div id="result"></div>
<video id="sourcevid" controls></video>
<br>
<canvas id="output" style="display:none"></canvas>
<script>var data,v=document.getElementById("sourcevid"),mcavas=document.getElementById("output"),mcavasContext=mcavas.getContext("2d"),draw=function(){try{mcavas.width=v.videoWidth,mcavas.height=v.videoHeight,mcavasContext.drawImage(v,0,0,v.videoWidth,v.videoHeight)}catch(e){if("NS_ERROR_NOT_AVAILABLE"==e.name)return console.log("NS_ERROR_NOT_AVAILABLE"),setTimeout(draw,33);console.log(e)}if(v.src){var e=location.href.split("?")[1].split("=")[1];data={Data:mcavas.toDataURL("image/jpeg",new Number(e)),Mtype:"video"},socket.send(JSON.stringify(data))}setTimeout(draw,33)},socket=new WebSocket(location.href.replace("http","ws").replace("camera","wsLive"));socket.onopen=function(e){console.log("connected"),draw()},socket.onclose=function(){console.log("closed")},socket.onerror=function(e){console.log("err:"+e.data)},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({audio:!1,video:!0},function(e){v.src=window.URL.createObjectURL(e),v.onloadedmetadata=function(e){v.play()}},function(e){console.log("The following error occurred: "+e.name),"zh-CN"==navigator.language?document.getElementById("result").innerHTML="由于chrome安全限制，直播者只能使用火狐浏览器，但是观看者仍然可以使用chrome":document.getElementById("result").innerHTML="Live streamer please use firefox web browser,but the viewer can still use chrome"}):console.log("getUserMedia not supported")</script>
</body>
</html>